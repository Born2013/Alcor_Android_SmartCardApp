package com.bird.smt_sw;import android.app.Activity;import android.content.ComponentName;import android.content.Intent;import android.os.Bundle;import android.view.View;import android.widget.Button;import android.widget.LinearLayout;import android.os.Build;import android.widget.TextView;import android.util.Log;//[BIRD][BIRD_FACTORY_ASSEMBLE_TEST_OTG_SUPPORT][工厂装配测试 OTG][husijia][20151124]beginimport android.hardware.usb.UsbManager;import android.content.Context;import android.content.BroadcastReceiver;import android.content.IntentFilter;import android.content.SharedPreferences;//[BIRD][BIRD_FACTORY_ASSEMBLE_TEST_OTG_SUPPORT][工厂装配测试 OTG][husijia][20151124]endpublic class MMITestOTGOpen extends MMINewActivity {	private Button correctButton;	private Button errorButton;	private Button resetButton;	private TextView Otg;	private TextView OtgValue;	//[BIRD][BIRD_FACTORY_ASSEMBLE_TEST_OTG_SUPPORT][工厂装配测试 OTG][husijia][20151124]begin	private TextView OtgDevice;	private TextView OtgDeviceList;	//[BIRD][BIRD_FACTORY_ASSEMBLE_TEST_OTG_SUPPORT][工厂装配测试 OTG][husijia][20151124]end	private int req_token;	//[BIRD][BIRD_FACTORY_ASSEMBLE_TEST_OTG_SUPPORT][工厂装配测试 OTG][husijia][20151124]begin   	private UsbManager mUsbManager;	private static final String ACTION_USB_PERMISSION =            	"android.mtp.MtpClient.action.USB_PERMISSION";	//[BIRD][BIRD_FACTORY_ASSEMBLE_TEST_OTG_SUPPORT][工厂装配测试 OTG][husijia][20151124]end			    private SharedPreferences mPreferences;    private SharedPreferences.Editor mEditor;    @Override    public void onCreate(Bundle savedInstanceState) {    	        super.onCreate(savedInstanceState);        setContentView(R.layout.otg_support);         setTitle(R.string.otg_sw);   		//1124 xuzhenguo		//req_token = getIntent().getIntExtra(MMITest.TOKEN, 0);		mPreferences = getSharedPreferences("mmitest", MODE_PRIVATE);        mEditor = mPreferences.edit();        correctButton = (Button) findViewById(R.id.correct);		errorButton = (Button) findViewById(R.id.error);		resetButton = (Button) findViewById(R.id.reset);		correctButton.setOnClickListener(mCorrectButtonHandler);		errorButton.setOnClickListener(mErrorButtonHandler);		resetButton.setOnClickListener(mRestdButtonHandler);		Otg = (TextView) findViewById(R.id.otg);		OtgValue = (TextView) findViewById(R.id.otg_value);        Otg.setText(R.string.otg_mk_confg);        //OtgValue.setText(FeatureOption.MTK_FAN5405_SUPPORT? R.string.support : R.string.not_support);		//[BIRD][BIRD_FACTORY_ASSEMBLE_TEST_OTG_SUPPORT][工厂装配测试 OTG][husijia][20151124]begin		OtgDevice = (TextView) findViewById(R.id.otg_device);		OtgDeviceList = (TextView) findViewById(R.id.otg_device_list);		OtgDevice.setText(R.string.otg_device);		mUsbManager = (UsbManager)this.getSystemService(Context.USB_SERVICE);		if(mUsbManager.getDeviceList().values().toString().equals("[]")){			OtgDeviceList.setText(R.string.otg_not_connected);		}else{			OtgDeviceList.setText(R.string.otg_connected);		}		//[BIRD][BIRD_FACTORY_ASSEMBLE_TEST_OTG_SUPPORT][工厂装配测试 OTG][husijia][20151124]end	}	private View.OnClickListener mCorrectButtonHandler = new View.OnClickListener() {		public void onClick(View v) {			mEditor.putInt(getString(R.string.otg_test), Test_launcherActivity.PASS);			mEditor.commit();			finish();		}	};	private View.OnClickListener mErrorButtonHandler = new View.OnClickListener() {		public void onClick(View v) {			mEditor.putInt(getString(R.string.otg_test), Test_launcherActivity.FAIL);			mEditor.commit();			finish();		}	};	private View.OnClickListener mRestdButtonHandler = new View.OnClickListener() {		public void onClick(View v) {			Intent intent = new Intent();			ComponentName comp = new ComponentName(MMITestOTGOpen.this, MMITestOTGOpen.class);			intent.setComponent(comp);						startActivity(intent);			finish();		}	};	//[BIRD][BIRD_FACTORY_ASSEMBLE_TEST_OTG_SUPPORT][工厂装配测试 OTG][husijia][20151124]begin	private BroadcastReceiver mUsbReceiver = new BroadcastReceiver() {        @Override        public void onReceive(Context context, Intent intent) {            String action = intent.getAction();			Log.i("pangmeizhou","mUsbReceiver action = "+action);                if (UsbManager.ACTION_USB_DEVICE_ATTACHED.equals(action)||UsbManager.ACTION_USB_DEVICE_DETACHED.equals(action)) {					if(mUsbManager.getDeviceList().values().toString().equals("[]")){						OtgDeviceList.setText(R.string.otg_not_connected);					}else{						OtgDeviceList.setText(R.string.otg_connected);					}				}		}	};	@Override	protected void onResume() {		IntentFilter filter = new IntentFilter();        filter.addAction(UsbManager.ACTION_USB_DEVICE_ATTACHED);        filter.addAction(UsbManager.ACTION_USB_DEVICE_DETACHED);        filter.addAction(ACTION_USB_PERMISSION);        registerReceiver(mUsbReceiver, filter);		super.onResume();	}	@Override	protected void onDestroy() {		unregisterReceiver(mUsbReceiver);		super.onDestroy();	}	//[BIRD][BIRD_FACTORY_ASSEMBLE_TEST_OTG_SUPPORT][工厂装配测试 OTG][husijia][20151124]end	/*@Override	protected void onActivityResult(int requestCode, int resultCode, Intent data) {		if (resultCode == MMITest.FAIL) {			Intent intent = new Intent();			setResult(MMITest.FAIL, intent);		} else if (resultCode == MMITest.PASS) {			Intent intent = new Intent();			setResult(MMITest.PASS, intent);		}		finish();		super.onActivityResult(requestCode, resultCode, data);	}*/    } 